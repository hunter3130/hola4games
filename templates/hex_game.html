{% extends 'base.html' %}

{% block title %}Hex Game{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/hex.css') }}">
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<div id="winMessage" class="win-message"></div>

<div class="content">
  <h1 >ğŸ® Ù„Ø¹Ø¨Ø© Ø­Ø±ÙˆÙ Ø§Ø¨Ùˆ ÙˆØ³Ù€Ù€Ù€Ø§Ù… ğŸ®</h1>
<!-- Ø²Ø± Ø§Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯ -->
    <form action="{{ url_for('start_new_game') }}" method="get">
    <button type="submit" class="btn btn-warning">ğŸ”„ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
</form>
  <div class="main-wrapper" >

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
    <div class="team-card" style="border-top: 5px solid #e74c3c;">
      <h3 style="margin-bottom: 10px;">ğŸ”´ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</h3>
      <p>ÙƒÙˆØ¯ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±: <strong>{{ red_code }}</strong></p>
      <div class="helps red-team" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
  <button class="help-card" data-help="ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±ØµØ§Ù†">ğŸ´â€â˜ ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±ØµØ§Ù†</button>
  <button class="help-card" data-help="ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†">ğŸˆ ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†</button>
  <button class="help-card" data-help="ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„">ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„</button>
  <button class="help-card" data-help="ØªÙ„Ù…ÙŠØ­">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
  <button class="help-card" data-help="Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡">ğŸ”´ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡</button>
</div>

    </div>

    <!-- Ø§Ù„Ø´Ø¨ÙƒØ© ÙÙŠ Ø§Ù„ÙˆØ³Ø· -->
    <div class="container">
      <div class="top"></div>
      <div class="bottom"></div>
      <div class="left"></div>
      <div class="right"></div>
      <div class="hex-grid" id="hexGrid">
        {% for row in range(5) %}
        <div class="hex-row{% if row % 2 != 0 %} offset{% endif %}">
          {% for col in range(5) %}
          {% set unique_index = (row * 5 + col) % letters|length %}
          <button class="hex" data-cell="{{ row }}-{{ col }}" data-letter="{{ letters[unique_index] }}">
            {{ letters[unique_index] }}
          </button>
          {% endfor %}
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
    <div class="team-card" style="border-top: 5px solid #3498db;">
      <h3 style="margin-bottom: 10px;">ğŸ”µ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</h3>
      <p>ÙƒÙˆØ¯ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚: <strong>{{ blue_code }}</strong></p>
     <div class="helps blue-team" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
        <button class="help-card" data-help="ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±ØµØ§Ù†">ğŸ´â€â˜ ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±ØµØ§Ù†</button>
        <button class="help-card" data-help="ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†">ğŸˆ ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†</button>
        <button class="help-card" data-help="ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„">ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„</button>
        <button class="help-card" data-help="ØªÙ„Ù…ÙŠØ­">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
        <button class="help-card" data-help="Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡">ğŸ”´ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡</button>
      </div>

    </div>

  </div>
</div>

<div id="questionModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø®ØªØ§Ø±: <span id="modal-letter" style="color:#007bff; font-size: 48px;"></span></h2>
    <img id="modal-image" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø±Ù" style="width: 150px; height: 150px; object-fit: contain; margin: 10px 0;" />
     
    <div id="timer" style="display:none; font-size: 20px; font-weight: bold; margin-bottom: 15px;">
      Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer-value">30</span> Ø«Ø§Ù†ÙŠØ©
    </div>
    <button id="start-timer" class="btn start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¤Ù‚Øª</button>
    <div style="margin-top: 20px;">
      <button id="team1" class="team-btn" style="background-color: rgba(110, 0, 0, 0.648);">ğŸ”¶ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
      <button id="team2" class="team-btn" style="background-color: rgba(0, 79, 128, 0.803); color: white;">ğŸ”µ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</button>
      <div style="margin-top: 15px;">
       
        <button id="resetBuzzer">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø²Ø±</button>
      </div>
      <div id="buzzerResult" style="margin-top: 10px; font-weight: bold; font-size: 18px;"></div>
    </div>
  </div>
</div>


<script>
const socket = io();
const teamName = localStorage.getItem("team_name");  // ÙŠØ£Ø®Ø° Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
document.addEventListener("DOMContentLoaded", () => {
    socket.emit("get_initial_helpers_state");
});

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
socket.on("initial_helpers_state", (data) => {
    updateHelpersUI(data);
});

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function updateHelpersUI(helpersData) {
    // ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±
    Object.entries(helpersData.red.helpers).forEach(([helper, used]) => {
        const redHelperBtn = document.querySelector(`.red-team .help-card[data-help="${helper}"]`);
        if (redHelperBtn && used) {
            redHelperBtn.disabled = true;
            redHelperBtn.style.textDecoration = 'line-through';
            redHelperBtn.innerHTML += ' âœ…';
        }
    });

    // ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚
    Object.entries(helpersData.blue.helpers).forEach(([helper, used]) => {
        const blueHelperBtn = document.querySelector(`.blue-team .help-card[data-help="${helper}"]`);
        if (blueHelperBtn && used) {
            blueHelperBtn.disabled = true;
            blueHelperBtn.style.textDecoration = 'line-through';
            blueHelperBtn.innerHTML += ' âœ…';
        }
    });
}
// Ø´Ø·Ø¨ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
socket.on('helper_update', (data) => {
  const { team, helper } = data;
  disableHelper(team, helper);
});
socket.on('disable_helper', (data) => {
  const { team, helper } = data;
  disableHelper(team, helper);
});

function disableHelper(team, helper) {
  const teamCard = team === 'red' 
    ? document.querySelector('.team-card[style*="#e74c3c"]') 
    : document.querySelector('.team-card[style*="#3498db"]');

  if (teamCard) {
    const button = teamCard.querySelector(`.help-card[data-help="${helper}"]`);
    if (button) {
      button.disabled = true;
      button.style.textDecoration = 'line-through';
    }
  }
}


// Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø§Ø²Ø±
socket.on("buzz", (data) => {
  const team = data.team;
  const winnerMsg = `ğŸš¨ Ø§Ù„ÙØ±ÙŠÙ‚ ${team === 'red' ? 'Ø§Ù„Ø£Ø­Ù…Ø±' : 'Ø§Ù„Ø£Ø²Ø±Ù‚'} Ø¶ØºØ· Ø£ÙˆÙ„Ø§Ù‹!`;
  const buzzerResult = document.getElementById("buzzerResult");
  if (buzzerResult) buzzerResult.innerText = winnerMsg;

  // Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©
  const winnerMessage = document.createElement("div");
  winnerMessage.id = "buzzer-winner";
  winnerMessage.innerText = winnerMsg;
  winnerMessage.style.position = 'fixed';
  winnerMessage.style.top = '40%';
  winnerMessage.style.left = '50%';
  winnerMessage.style.transform = 'translate(-50%, -50%)';
  winnerMessage.style.fontSize = '2.5rem';
  winnerMessage.style.background = '#fff';
  winnerMessage.style.padding = '20px 40px';
  winnerMessage.style.borderRadius = '15px';
  winnerMessage.style.boxShadow = '0 0 20px rgba(0,0,0,0.2)';
  winnerMessage.style.zIndex = 9999;
  document.body.appendChild(winnerMessage);
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
  setTimeout(() => {
    if (document.body.contains(winnerMessage)) {
      document.body.removeChild(winnerMessage);
    }
  }, 5000);
});

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø§Ø²Ø±
const resetBtn = document.getElementById("resetBuzzer");
if (resetBtn) {
  resetBtn.addEventListener("click", () => {
    socket.emit("reset_buzzer");
  });
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø§Ø²Ø± Ù…Ù† Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚
const buzzerBtn = document.getElementById("buzzer-button");
if (buzzerBtn) {
  buzzerBtn.addEventListener("click", () => {
    if (teamName) {
      socket.emit("buzz", { team: teamName });
      buzzerBtn.disabled = true;
    }
  });
}


// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± (Ø£Ø¯Ù…Ù†/Ù…ØªØ³Ø§Ø¨Ù‚)
window.addEventListener("DOMContentLoaded", () => {
  const isAdmin = localStorage.getItem("is_admin") === "true";

  if (isAdmin) {
    document.getElementById("startQuestion").style.display = "inline-block";
    document.getElementById("resetBuzzer").style.display = "inline-block";
    document.getElementById("buzzer-section").style.display = "none";
  } else {
    document.getElementById("startQuestion").style.display = "none";
    document.getElementById("resetBuzzer").style.display = "none";
    document.getElementById("buzzer-section").style.display = "block";
  }
});
</script>

<script src="{{ url_for('static', filename='js/hex.js') }}" defer></script>
{% endblock %}
