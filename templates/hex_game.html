{% extends 'base.html' %}

{% block title %}Hex Game{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/hex.css') }}">
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<div id="winMessage" class="win-message"></div>

<div class="content">
  <h1 >🎮 لعبة حروف ابو وســـام 🎮</h1>
<!-- زر اعادة اللعبة من جديد -->
    <form action="{{ url_for('start_new_game') }}" method="get">
    <button type="submit" class="btn btn-warning">🔄 لعبة جديدة</button>
</form>
  <div class="main-wrapper" >

    <!-- بطاقة الفريق الأحمر على اليسار -->
    <div class="team-card" style="border-top: 5px solid #e74c3c;">
      <h3 style="margin-bottom: 10px;">🔴 الفريق الأول</h3>
      <p>كود الفريق الأحمر: <strong>{{ red_code }}</strong></p>
      <div class="helps red-team" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
  <button class="help-card" data-help="pirate">🏴‍☠️ تحدي القرصان</button>
  <button class="help-card" data-help="balloon">🎈 تحدي البالون</button>
  <button class="help-card" data-help="change_question">🔄 تغيير السؤال</button>
  <button class="help-card" data-help="hint">💡 تلميح</button>
  <button class="help-card" data-help="red_card">🔴 كرت أحمر</button>
</div>

    </div>

    <!-- الشبكة في الوسط -->
    <div class="container">
      <div class="top"></div>
      <div class="bottom"></div>
      <div class="left"></div>
      <div class="right"></div>
      <div class="hex-grid" id="hexGrid">
        {% for row in range(5) %}
        <div class="hex-row{% if row % 2 != 0 %} offset{% endif %}">
          {% for col in range(5) %}
          {% set unique_index = (row * 5 + col) % letters|length %}
          <button class="hex" data-cell="{{ row }}-{{ col }}" data-letter="{{ letters[unique_index] }}">
            {{ letters[unique_index] }}
          </button>
          {% endfor %}
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- بطاقة الفريق الأزرق على اليمين -->
    <div class="team-card" style="border-top: 5px solid #3498db;">
      <h3 style="margin-bottom: 10px;">🔵 الفريق الثاني</h3>
      <p>كود الفريق الأزرق: <strong>{{ blue_code }}</strong></p>
     <div class="helps blue-team" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
  <button class="help-card" data-help="pirate">🏴‍☠️ تحدي القرصان</button>
  <button class="help-card" data-help="balloon">🎈 تحدي البالون</button>
  <button class="help-card" data-help="change_question">🔄 تغيير السؤال</button>
  <button class="help-card" data-help="hint">💡 تلميح</button>
  <button class="help-card" data-help="red_card">🔴 كرت أحمر</button>
</div>

    </div>

  </div>
</div>

<div id="questionModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>الحرف المختار: <span id="modal-letter" style="color:#007bff; font-size: 48px;"></span></h2>
    <img id="modal-image" src="" alt="صورة الحرف" style="width: 150px; height: 150px; object-fit: contain; margin: 10px 0;" />
    <p id="modal-question">السؤال هنا...</p>
    <div id="timer" style="display:none; font-size: 20px; font-weight: bold; margin-bottom: 15px;">
      الوقت المتبقي: <span id="timer-value">30</span> ثانية
    </div>
    <button id="start-timer">ابدأ المؤقت</button>
    <div style="margin-top: 20px;">
      <button id="team1" class="team-btn" style="background-color: rgba(110, 0, 0, 0.648);">🔵 الفريق الأول</button>
      <button id="team2" class="team-btn" style="background-color: rgba(0, 79, 128, 0.803); color: white;">🔶 الفريق الثاني</button>
      <div style="margin-top: 15px;">
        <button id="startQuestion" style="margin-left: 5px;">🔹 عرض السؤال</button>
        <button id="resetBuzzer">🔄 إعادة البازر</button>
      </div>
      <div id="buzzerResult" style="margin-top: 10px; font-weight: bold; font-size: 18px;"></div>
    </div>
  </div>
</div>


<script>
const socket = io();
const teamName = localStorage.getItem("team_name");  // يأخذ اسم الفريق من التخزين المحلي


// عرض نتيجة البازر
socket.on("buzz", (data) => {
  const team = data.team;
  const winnerMsg = `🚨 الفريق ${team === 'red' ? 'الأحمر' : 'الأزرق'} ضغط أولاً!`;
  const buzzerResult = document.getElementById("buzzerResult");
  if (buzzerResult) buzzerResult.innerText = winnerMsg;

  // إظهار في منتصف الشاشة
  const winnerMessage = document.createElement("div");
  winnerMessage.id = "buzzer-winner";
  winnerMessage.innerText = winnerMsg;
  winnerMessage.style.position = 'fixed';
  winnerMessage.style.top = '40%';
  winnerMessage.style.left = '50%';
  winnerMessage.style.transform = 'translate(-50%, -50%)';
  winnerMessage.style.fontSize = '2.5rem';
  winnerMessage.style.background = '#fff';
  winnerMessage.style.padding = '20px 40px';
  winnerMessage.style.borderRadius = '15px';
  winnerMessage.style.boxShadow = '0 0 20px rgba(0,0,0,0.2)';
  winnerMessage.style.zIndex = 9999;
  document.body.appendChild(winnerMessage);
});

// إعادة تعيين البازر
document.getElementById("resetBuzzer").addEventListener("click", () => {
  socket.emit("reset_buzzer");
});

socket.on("buzzer_reset", () => {
  const msg = document.getElementById("buzzer-winner");
  if (msg) msg.remove();

  const buzzerResult = document.getElementById("buzzerResult");
  if (buzzerResult) buzzerResult.innerText = "";
});

// إرسال البازر من المتسابق
document.getElementById("buzzer-button").addEventListener("click", () => {
  if (teamName) {
    socket.emit("buzz", { team: teamName });
    document.getElementById("buzzer-button").disabled = true;
  }
});

// إظهار العناصر حسب الدور (أدمن/متسابق)
window.addEventListener("DOMContentLoaded", () => {
  const isAdmin = localStorage.getItem("is_admin") === "true";

  if (isAdmin) {
    document.getElementById("startQuestion").style.display = "inline-block";
    document.getElementById("resetBuzzer").style.display = "inline-block";
    document.getElementById("buzzer-section").style.display = "none";
  } else {
    document.getElementById("startQuestion").style.display = "none";
    document.getElementById("resetBuzzer").style.display = "none";
    document.getElementById("buzzer-section").style.display = "block";
  }
});
</script>

<script src="{{ url_for('static', filename='js/hex.js') }}" defer></script>
{% endblock %}
